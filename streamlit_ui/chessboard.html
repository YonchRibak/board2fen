<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Chess Board</title>

    <!-- Chessboard.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f0f2f6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chess-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 600px;
            width: 100%;
        }

        #board {
            margin: 0 auto 20px auto;
            width: 480px;
            max-width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .piece-banks-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
        }

        .fen-section {
            margin-top: 20px;
            text-align: left;
        }

        .fen-label {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .fen-display {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 13px;
            word-break: break-all;
            line-height: 1.5;
            color: #2d3748;
        }

        .instructions {
            margin-top: 16px;
            padding: 12px;
            background-color: #ebf8ff;
            border-left: 4px solid #3182ce;
            border-radius: 4px;
            font-size: 13px;
            color: #2c5282;
        }

        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 4px;
        }

        /* Style the spare piece containers */
        [class*="spare-pieces"] {
            display: flex !important;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            padding: 8px;
            background-color: #f7fafc;
            border-radius: 6px;
            margin: 4px auto;
            max-width: 480px;
        }

        /* Make spare pieces look nicer */
        [class*="spare-pieces"] img {
            border-radius: 4px;
            transition: transform 0.2s;
        }

        [class*="spare-pieces"] img:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="chess-container">
        <div class="piece-banks-label">
            <span>⚪ White Pieces</span>
            <span>⚫ Black Pieces</span>
        </div>

        <div id="board"></div>

        <div class="fen-section">
            <div class="fen-label">Current Board Position (FEN):</div>
            <div id="fen-display" class="fen-display">Loading...</div>
        </div>

        <div class="instructions">
            <strong>How to use:</strong>
            <ul>
                <li>Drag pieces from the piece banks above and below to place them on the board</li>
                <li>Drag pieces around the board to move them</li>
                <li>Drag pieces off the board to remove them</li>
                <li>The FEN notation updates automatically as you make changes</li>
            </ul>
        </div>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

    <script>
        let board = null;
        let currentFen = '{initial_fen}';

        function updateFenDisplay(fen) {
            const fenElement = document.getElementById('fen-display');
            if (fenElement) {
                fenElement.textContent = fen;
            }
        }

        function onDrop() {
            // Use setTimeout to ensure board state is updated
            setTimeout(() => {
                if (board) {
                    const newFen = board.fen();
                    updateFenDisplay(newFen);
                    currentFen = newFen;
                }
            }, 50);
        }

        function onSnapEnd() {
            if (board) {
                const newFen = board.fen();
                updateFenDisplay(newFen);
                currentFen = newFen;
            }
        }

        // Initialize the chess board
        function initBoard() {
            const config = {
                draggable: true,
                position: currentFen,
                sparePieces: true,
                dropOffBoard: 'trash',
                onDrop: onDrop,
                onSnapEnd: onSnapEnd,
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
            };

            try {
                board = Chessboard('board', config);
                updateFenDisplay(currentFen);
                console.log('Chess board initialized successfully');
            } catch (error) {
                console.error('Error initializing chess board:', error);
                document.getElementById('fen-display').textContent = 'Error loading chess board';
            }
        }

        // Start when DOM is ready
        document.addEventListener('DOMContentLoaded', initBoard);
    </script>
</body>
</html>